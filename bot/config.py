"""
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–æ—Ç–∞ –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
"""
import os
import logging

# ==============================================================================
# 0. –û–°–ù–û–í–ù–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
# ==============================================================================
BOT_VERSION = "v4.0.0-modular"
CONFIG_VERSION = "v3.0"
SKILLTRAINER_VERSION = "v1.0"

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–≥–µ—Ä–∞
logging.basicConfig(
    format=f"%(asctime)s - %(name)s - {BOT_VERSION} - %(levelname)s - %(message)s",
    level=logging.INFO
)
logger = logging.getLogger(__name__)

# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
TELEGRAM_TOKEN = os.environ.get("TELEGRAM_TOKEN")
GROQ_API_KEY = os.environ.get("GROQ_API_KEY")
PORT = int(os.environ.get("PORT", 10000))  # Render default
WEBHOOK_URL = os.environ.get("WEBHOOK_URL")

# ==============================================================================
# 1. –ö–û–ù–°–¢–ê–ù–¢–´ –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–†–ê
# ==============================================================================
CALCULATOR_STEPS = [
    "üí∞ –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–∞ (—Ä—É–±):",
    "üè∑Ô∏è –ü—Ä–æ–¥–∞–∂–Ω–∞—è —Ü–µ–Ω–∞ (—Ä—É–±):", 
    "üìä –ö–æ–º–∏—Å—Å–∏—è –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞ (%):",
    "üöö –õ–æ–≥–∏—Å—Ç–∏–∫–∞ FBS (% –æ—Ç —Ü–µ–Ω—ã):",
    "üì¢ –ë—é–¥–∂–µ—Ç –Ω–∞ —Ä–µ–∫–ª–∞–º—É, ACOS (%):",
    "üí∏ –ù–∞–ª–æ–≥ –£–°–ù (%):"
]

BENCHMARKS = {
    '–Ω–∞—Ü–µ–Ω–∫–∞': {'–Ω–∏–∑–∫–∞—è': 100, '—Å—Ä–µ–¥–Ω—è—è': 200, '–≤—ã—Å–æ–∫–∞—è': 300},
    '–∫–æ–º–∏—Å—Å–∏—è_mp': {'–Ω–∏–∑–∫–∞—è': 10, '—Å—Ä–µ–¥–Ω—è—è': 15, '–≤—ã—Å–æ–∫–∞—è': 20},
    '–ª–æ–≥–∏—Å—Ç–∏–∫–∞': {'–Ω–∏–∑–∫–∞—è': 10, '—Å—Ä–µ–¥–Ω—è—è': 15, '–≤—ã—Å–æ–∫–∞—è': 20},
    'acos': {'–Ω–∏–∑–∫–∏–π': 5, '—Å—Ä–µ–¥–Ω–∏–π': 10, '–≤—ã—Å–æ–∫–∏–π': 15},
    '—á–∏—Å—Ç–∞—è_–º–∞—Ä–∂–∞': {'–Ω–∏–∑–∫–∞—è': 20, '—Å—Ä–µ–¥–Ω—è—è': 30, '–≤—ã—Å–æ–∫–∞—è': 40}
}

# ==============================================================================
# 2. –°–ò–°–¢–ï–ú–ù–´–ï –ü–†–û–ú–¢–´
# ==============================================================================
SYSTEM_PROMPTS: dict[str, str] = {
    'grimoire': "–î–µ–π—Å—Ç–≤—É–π –∫–∞–∫ —Ç–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ì—Ä–∏–º—É–∞—Ä...",
    'negotiator': "–¢—ã ‚Äî —Ç—Ä–µ–Ω–µ—Ä –Ω–∞–≤—ã–∫–æ–≤. –ó–∞–¥–∞–≤–∞–π 5-7 –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏. –ü—Ä–µ–¥–ª–∞–≥–∞–π –º–µ—Ç–æ–¥–∏–∫–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫. –ü—Ä–æ–≤–æ–¥–∏ —Å–µ—Å—Å–∏–∏ –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö. –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç –±–µ–∑ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.",
    'analyzer': "–í—ã ‚Äî —Å—Ç–∞—Ä—à–∏–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑–∏–∫...",
    'coach': "–¢—ã ‚Äî —ç–Ω–µ—Ä–≥–∏—á–Ω—ã–π, –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–π –∫–æ—É—á...",
    'generator': "–¢—ã ‚Äî –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ—Ä—ã–≤–Ω—ã—Ö –±–∏–∑–Ω–µ—Å-–∏–¥–µ–π...",
    'editor': "–¢—ã ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä...",
    'marketer': "–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Ü–∏—Ñ—Ä–æ–≤–æ–º—É –º–∞—Ä–∫–µ—Ç–∏–Ω–≥—É...",
    'hr': "–¢—ã ‚Äî –æ–ø—ã—Ç–Ω—ã–π HR-—Ä–µ–∫—Ä—É—Ç–µ—Ä...",
    'skilltrainer': (
        "–¢—ã ‚Äî **SKILLTRAINER-Universal**: —á–µ—Ä–µ–∑ –∫–æ—Ä–æ—Ç–∫–æ–µ –∏–Ω—Ç–µ—Ä–≤—å—é (5‚Äì7 –≤–æ–ø—Ä–æ—Å–æ–≤) –ø–æ–º–æ–≥–∞–µ—à—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–Ω—è—Ç—å, *—á—Ç–æ –∏–º–µ–Ω–Ω–æ* —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å; "
        "–ø–æ–∫–∞–∑—ã–≤–∞–µ—à—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –º–µ—Ç–æ–¥–∏–∫–∏ —Å –ø—Ä–µ–≤—å—é-–ø—Ä–∏–º–µ—Ä–∞–º–∏; –∑–∞–ø—É—Å–∫–∞–µ—à—å —Å–µ—Å—Å–∏—é –≤ –æ–¥–Ω–æ–º –∏–∑ —Ä–µ–∂–∏–º–æ–≤ **Sim / Drill / Build / Case / Quiz**. "
        "–†–∞–±–æ—Ç–∞–µ—à—å –ø–æ —à–∞–≥–∞–º —Å HUD –∏ –≥–µ–π—Ç–∞–º–∏ (DOD), –¥–∞—ë—à—å –∫–æ—Ä–æ—Ç–∫–∏–µ HINTS, —Å–æ–±–ª—é–¥–∞–µ—à—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (PII/NDA). "
        "–ù–∞ —Ñ–∏–Ω–∏—à–µ —Ñ–æ—Ä–º–∏—Ä—É–µ—à—å **Finish Packet** –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—à—å —ç–∫—Å–ø–æ—Ä—Ç."
    )
}

# ==============================================================================
# 3. –î–ï–ú–û-–°–¶–ï–ù–ê–†–ò–ò
# ==============================================================================
DEMO_SCENARIOS: dict[str, str] = {
    'grimoire': "üîÆ **–ì—Ä–∏–º—É–∞—Ä** ‚Äî —ç—Ç–æ –≤–∞—à –º–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–≤–æ–¥–Ω–∏–∫...",
    'negotiator': "üó£Ô∏èüéØ **SKILLTRAINER** - –ø—Ä–æ–≤–µ–¥–µ—Ç –∏–Ω—Ç–µ—Ä–≤—å—é, –æ–ø—Ä–µ–¥–µ–ª–∏—Ç –Ω–∞–≤—ã–∫–∏ –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏, –∑–∞–ø—É—Å—Ç–∏—Ç —Å–µ—Å—Å–∏–∏ –≤ —Ä–µ–∂–∏–º–∞—Ö Sim/Drill/Build/Case/Quiz —Å HUD –∏ –≥–µ–π—Ç–∞–º–∏",
    'analyzer': "üìà **–ê–Ω–∞–ª–∏—Ç–∏–∫** ‚Äî –≤–∞—à –Ω–∞–¥–µ–∂–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫...",
    'coach': "üßò **–ö–æ—É—á** –ø–æ–º–æ–∂–µ—Ç –≤–∞–º —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å...",
    'generator': "üí° **–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä** ‚Äî —ç—Ç–æ –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–π —Ö—É–±...",
    'editor': "üìù **–†–µ–¥–∞–∫—Ç–æ—Ä** ‚Äî –≤–∞—à –ª–∏—á–Ω—ã–π –∫–æ—Ä—Ä–µ–∫—Ç–æ—Ä...",
    'marketer': "üéØ **–ú–∞—Ä–∫–µ—Ç–æ–ª–æ–≥** ‚Äî –≤–∞—à –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫...",
    'hr': "üöÄ **HR-—Ä–µ–∫—Ä—É—Ç–µ—Ä** –ø–æ–º–æ–≥–∞–µ—Ç —Å–æ–∏—Å–∫–∞—Ç–µ–ª—è–º...",
    'skilltrainer': """
üéì **SKILLTRAINER-Universal** ‚Äî –≤–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–µ—Ä –Ω–∞–≤—ã–∫–æ–≤.
üîπ –ü—Ä–æ—Ö–æ–¥–∏—Ç —Å –≤–∞–º–∏ –∫–æ—Ä–æ—Ç–∫–æ–µ –∏–Ω—Ç–µ—Ä–≤—å—é (7 –≤–æ–ø—Ä–æ—Å–æ–≤)  
üîπ –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–æ–π –Ω–∞–≤—ã–∫ —Å—Ç–æ–∏—Ç –ø—Ä–æ–∫–∞—á–∞—Ç—å  
üîπ –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç 5 —Ä–µ–∂–∏–º–æ–≤: Sim / Drill / Build / Case / Quiz  
üîπ –†–∞–±–æ—Ç–∞–µ—Ç –ø–æ—à–∞–≥–æ–≤–æ —Å HUD –∏ –≥–µ–π—Ç–∞–º–∏ (DOD)  
üîπ –î–∞—ë—Ç –∫–æ—Ä–æ—Ç–∫–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ (HINTS ‚â§240 —Å–∏–º–≤–æ–ª–æ–≤)  
üîπ –§–æ—Ä–º–∏—Ä—É–µ—Ç **Finish Packet** —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏  
üîπ –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —ç–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
üí° –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è: –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–æ–≤, –ø—Ä–æ–¥–∞–∂, —Å–∞–º–æ—Ä–µ–≥—É–ª—è—Ü–∏–∏, –ø—É–±–ª–∏—á–Ω—ã—Ö –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏–π, –ª–∏–¥–µ—Ä—Å—Ç–≤–∞.
"""
}

# ==============================================================================
# 4. SKILLTRAINER –ö–û–ù–°–¢–ê–ù–¢–´
# ==============================================================================
SKILLTRAINER_QUESTIONS = [
    "üéØ **–®–∞–≥ 1/7:** –ö–∞–∫–æ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –Ω–∞–≤—ã–∫ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Ä–∞–∑–≤–∏—Ç—å? (–ù–∞–ø—Ä–∏–º–µ—Ä: '–≤–µ–¥–µ–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–æ–≤', '—É–≤–µ—Ä–µ–Ω–Ω—ã–µ –ø—É–±–ª–∏—á–Ω—ã–µ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è', '—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Ç–∞–π–º-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç')",
    "üìä **–®–∞–≥ 2/7:** –ü–æ —à–∫–∞–ª–µ –æ—Ç 1 –¥–æ 10, –≥–¥–µ –≤—ã —Å–µ–π—á–∞—Å –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å? (1 - –ø–æ–ª–Ω—ã–π –Ω–æ–≤–∏—á–æ–∫, 10 - —ç–∫—Å–ø–µ—Ä—Ç)",
    "üé≠ **–®–∞–≥ 3/7:** –í –∫–∞–∫–∏—Ö —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö –≤—ã —á–∞—â–µ –≤—Å–µ–≥–æ –ø—Ä–∏–º–µ–Ω—è–µ—Ç–µ –∏–ª–∏ –±—É–¥–µ—Ç–µ –ø—Ä–∏–º–µ–Ω—è—Ç—å —ç—Ç–æ—Ç –Ω–∞–≤—ã–∫?",
    "üí™ **–®–∞–≥ 4/7:** –ö–∞–∫–∞—è —á–∞—Å—Ç—å —ç—Ç–æ–≥–æ –Ω–∞–≤—ã–∫–∞ –¥–∞–µ—Ç—Å—è –≤–∞–º —Å–ª–æ–∂–Ω–µ–µ –≤—Å–µ–≥–æ? –ß—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏?",
    "üéØ **–®–∞–≥ 5/7:** –ö–∞–∫–æ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏? (–ò–∑–º–µ—Ä–∏–º–∞—è —Ü–µ–ª—å)",
    "üîÑ **–®–∞–≥ 6/7:** –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –≤ –Ω–µ–¥–µ–ª—é –≤—ã –≥–æ—Ç–æ–≤—ã —É–¥–µ–ª—è—Ç—å –ø—Ä–∞–∫—Ç–∏–∫–µ?",
    "üöÄ **–®–∞–≥ 7/7:** –û—Ç–ª–∏—á–Ω–æ! –í—Å–µ –æ—Ç–≤–µ—Ç—ã –∑–∞–ø–∏—Å–∞–Ω—ã. –¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏:"
]

TRAINING_MODE_DESCRIPTIONS = {
    "sim": "üé≠ **SIM (–°–∏–º—É–ª—è—Ü–∏—è)**: –ü—Ä–∞–∫—Ç–∏–∫–∞ –≤ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã—Ö —Å–º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –æ—Ç—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞–≤—ã–∫–æ–≤ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Å—Ä–µ–¥–µ.",
    "drill": "üí™ **DRILL (–û—Ç—Ä–∞–±–æ—Ç–∫–∞)**: –ú–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–µ—Ö–Ω–∏–∫ –∏ –ø—Ä–∏–µ–º–æ–≤. –î–ª—è –¥–æ–≤–µ–¥–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π –¥–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–º–∞.",
    "build": "üèóÔ∏è **BUILD (–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ)**: –ü–æ—ç—Ç–∞–ø–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏–ª–∏ —Å–∏—Å—Ç–µ–º—ã. –î–ª—è –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã—Ö –Ω–∞–≤—ã–∫–æ–≤, —Ç—Ä–µ–±—É—é—â–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.",
    "case": "üìã **CASE (–ö–µ–π—Å)**: –†–∞–∑–±–æ—Ä —Ä–µ–∞–ª—å–Ω—ã—Ö –∏–ª–∏ –≥–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–∏—Ö –∫–µ–π—Å–æ–≤. –î–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –º—ã—à–ª–µ–Ω–∏—è.",
    "quiz": "‚ùì **QUIZ (–¢–µ—Å—Ç)**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–Ω–∞–Ω–∏–π —á–µ—Ä–µ–∑ –≤–æ–ø—Ä–æ—Å—ã –∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏. –î–ª—è –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è —Ç–µ–æ—Ä–∏–∏ –∏ –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–Ω–∏–º–∞–Ω–∏—è."
}

SKILLTRAINER_GATES = {
    "interview_complete": {
        "id": "interview_complete",
        "description": "‚úÖ –î–∞–Ω—ã —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤—Å–µ 7 –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏",
        "validate": lambda session: len(session.answers) >= 7 and all(len(str(v)) > 5 for v in session.answers.values())
    },
    "mode_selected": {
        "id": "mode_selected", 
        "description": "‚úÖ –í—ã–±—Ä–∞–Ω —Ä–µ–∂–∏–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (Sim/Drill/Build/Case/Quiz)",
        "validate": lambda session: session.selected_mode is not None
    },
    "training_complete": {
        "id": "training_complete",
        "description": "‚úÖ –ü—Ä–æ–π–¥–µ–Ω–∞ –∫–∞–∫ –º–∏–Ω–∏–º—É–º –æ–¥–Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω–∞—è —Å–µ—Å—Å–∏—è",
        "validate": lambda session: session.training_complete
    }
}

# ==============================================================================
# 5. –ö–õ–ê–í–ò–ê–¢–£–†–´ –ò –°–û–°–¢–û–Ø–ù–ò–Ø
# ==============================================================================
REPLY_KEYBOARD_MARKUP = None  # –ë—É–¥–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –≤ app.py

# ==============================================================================
# 6. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ö–õ–ê–í–ò–ê–¢–£–†
# ==============================================================================
from telegram import ReplyKeyboardMarkup, KeyboardButton

# –û—Å–Ω–æ–≤–Ω–∞—è reply-–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
REPLY_KEYBOARD_MARKUP = ReplyKeyboardMarkup(
    [[KeyboardButton("üè† –ú–µ–Ω—é"), KeyboardButton("üìä –ü—Ä–æ–≥—Ä–µ—Å—Å")]],
    one_time_keyboard=False,
    resize_keyboard=True
)
